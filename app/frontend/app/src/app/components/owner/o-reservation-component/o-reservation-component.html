<h2>Rezervacije</h2>

<div class="list-card">
  <h3>Neobrađene</h3>
  <div style="margin-bottom: 10px; color: #666; font-size: 14px;">
    Ukupno rezervacija: {{allReservations.length}} | Neobrađene: {{unprocessed.length}}
  </div>
  <div *ngIf="unprocessed.length === 0">Nema neobrađenih rezervacija.</div>
  <table *ngIf="unprocessed.length > 0" border="1" cellspacing="0" cellpadding="8">
    <thead>
      <tr>
        <th>ID</th>
        <th>Turista</th>
        <th>Početak</th>
        <th>Kraj</th>
        <th>Gosti</th>
        <th>Cena</th>
        <th>Komentar (obavezno kod odbijanja)</th>
        <th>Akcije</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of unprocessed">
        <td>{{r.idRezervacije}}</td>
        <td>{{r.usernameTuriste}}</td>
        <td>{{r.pocetak | date:'dd.MM.yyyy, HH:mm'}}</td>
        <td>{{r.kraj | date:'dd.MM.yyyy, HH:mm'}}</td>
        <td>Odr: {{r.brojOdraslih}} / Deca: {{r.brojDece}}</td>
        <td>{{r.cena | currency:'EUR':'symbol':'1.2-2'}}</td>
        <td>
          <input type="text" [(ngModel)]="ownerComment[r.idRezervacije]" placeholder="Komentar (za odbijanje)">
        </td>
        <td>
          <button (click)="confirm(r)">Potvrdi</button>
          <button (click)="decline(r)" style="margin-left:6px;">Odbij</button>
        </td>
      </tr>
    </tbody>
  </table>
  <div class="error" style="color:#b00;">{{message}}</div>
</div>

<div style="margin-top: 20px;">
  <h3>Kalendar</h3>
  <div id="owner-calendar"></div>
  <div style="margin-top:8px;">
    <span style="display:inline-block; width:12px; height:12px; background:#f1c40f; margin-right:6px;"></span> Neobrađene
    <span style="display:inline-block; width:12px; height:12px; background:#2ecc71; margin: 0 6px 0 16px;"></span> Prihvaćene
    <span style="display:inline-block; width:12px; height:12px; background:#e74c3c; margin: 0 6px 0 16px;"></span> Odbijene
  </div>
</div>

<!-- Modalni dijalog za kalendar -->
@if (showDialog && selectedRezForDialog) {
  <div class="modal-overlay" (click)="closeDialog()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <h3>Rezervacija #{{selectedRezForDialog.idRezervacije}}</h3>
      <div class="dialog-info">
        <p><strong>Turista:</strong> {{selectedRezForDialog.usernameTuriste}}</p>
        <p><strong>Početak:</strong> {{selectedRezForDialog.pocetak | date:'dd.MM.yyyy, HH:mm'}}</p>
        <p><strong>Kraj:</strong> {{selectedRezForDialog.kraj | date:'dd.MM.yyyy, HH:mm'}}</p>
        <p><strong>Gosti:</strong> Odrasli: {{selectedRezForDialog.brojOdraslih}}, Deca: {{selectedRezForDialog.brojDece}}</p>
        <p><strong>Cena:</strong> {{selectedRezForDialog.cena | currency:'EUR':'symbol':'1.2-2'}}</p>
        @if (selectedRezForDialog.napomena) {
          <p><strong>Napomena:</strong> {{selectedRezForDialog.napomena}}</p>
        }
      </div>
      <div class="dialog-comment">
        <label>Komentar (obavezno za odbijanje):</label>
        <textarea [(ngModel)]="dialogComment" placeholder="Unesite komentar ako odbijate rezervaciju"></textarea>
      </div>
      <div class="dialog-actions">
        <button (click)="confirmFromDialog()" class="btn-confirm">Potvrdi</button>
        <button (click)="declineFromDialog()" class="btn-decline">Odbij</button>
        <button (click)="closeDialog()" class="btn-cancel">Otkaži</button>
      </div>
    </div>
  </div>
}
