<h2>Rezervacije</h2>

<div class="list-card">
  <div class="card-header">
    <h3>Neobrađene rezervacije</h3>
    <div class="stats-info">
      <span class="stat-item">
        <span class="stat-label">Ukupno:</span>
        <span class="stat-value">{{allReservations.length}}</span>
      </span>
      <span class="stat-item">
        <span class="stat-label">Neobrađene:</span>
        <span class="stat-value highlight">{{unprocessed.length}}</span>
      </span>
    </div>
  </div>

  @if (unprocessed.length === 0) {
    <div class="no-reservations">
      <p>Nema neobrađenih rezervacija.</p>
    </div>
  } @else {
    <div class="table-container">
      <table class="reservations-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Turista</th>
            <th>Početak</th>
            <th>Kraj</th>
            <th>Gosti</th>
            <th>Cena</th>
            <th>Komentar</th>
            <th>Akcije</th>
          </tr>
        </thead>
        <tbody>
          @for (r of unprocessed; track r.idRezervacije) {
            <tr>
              <td class="reservation-id">#{{r.idRezervacije}}</td>
              <td class="tourist-name">{{r.usernameTuriste}}</td>
              <td class="date-time">{{r.pocetak | date:'dd.MM.yyyy, HH:mm'}}</td>
              <td class="date-time">{{r.kraj | date:'dd.MM.yyyy, HH:mm'}}</td>
              <td class="guests">
                <span class="adults">Odrasli: {{r.brojOdraslih}}</span>
                @if (r.brojDece > 0) {
                  <span class="children">Deca: {{r.brojDece}}</span>
                }
              </td>
              <td class="price">{{r.cena | currency:'EUR':'symbol':'1.2-2'}}</td>
              <td class="comment-cell">
                <input 
                  type="text" 
                  [(ngModel)]="ownerComment[r.idRezervacije]" 
                  placeholder="Komentar (obavezno za odbijanje)"
                  class="comment-input"
                >
              </td>
              <td class="actions-cell">
                <div class="action-buttons">
                  <button (click)="confirm(r)" class="btn-confirm-table">Potvrdi</button>
                  <button (click)="decline(r)" class="btn-decline-table">Odbij</button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
  
  @if (message) {
    <div class="error-message">{{message}}</div>
  }
</div>

<div class="calendar-section">
  <h3>Kalendar rezervacija</h3>
  <div id="owner-calendar"></div>
  <div class="calendar-legend">
    <div class="legend-item">
      <span class="legend-color" style="background:#f1c40f;"></span>
      <span>Neobrađene</span>
    </div>
    <div class="legend-item">
      <span class="legend-color" style="background:#2ecc71;"></span>
      <span>Prihvaćene</span>
    </div>
  </div>
</div>

<!-- Modalni dijalog za kalendar -->
@if (showDialog && selectedRezForDialog) {
  <div class="modal-overlay" (click)="closeDialog()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <h3>Rezervacija #{{selectedRezForDialog.idRezervacije}}</h3>
      <div class="dialog-info">
        <p><strong>Turista:</strong> {{selectedRezForDialog.usernameTuriste}}</p>
        <p><strong>Početak:</strong> {{selectedRezForDialog.pocetak | date:'dd.MM.yyyy, HH:mm'}}</p>
        <p><strong>Kraj:</strong> {{selectedRezForDialog.kraj | date:'dd.MM.yyyy, HH:mm'}}</p>
        <p><strong>Gosti:</strong> Odrasli: {{selectedRezForDialog.brojOdraslih}}, Deca: {{selectedRezForDialog.brojDece}}</p>
        <p><strong>Cena:</strong> {{selectedRezForDialog.cena | currency:'EUR':'symbol':'1.2-2'}}</p>
        @if (selectedRezForDialog.napomena) {
          <p><strong>Napomena:</strong> {{selectedRezForDialog.napomena}}</p>
        }
      </div>
      <div class="dialog-comment">
        <label>Komentar (obavezno za odbijanje):</label>
        <textarea [(ngModel)]="dialogComment" placeholder="Unesite komentar ako odbijate rezervaciju"></textarea>
      </div>
      <div class="dialog-actions">
        <button (click)="confirmFromDialog()" class="btn-confirm">Potvrdi</button>
        <button (click)="declineFromDialog()" class="btn-decline">Odbij</button>
        <button (click)="closeDialog()" class="btn-cancel">Otkaži</button>
      </div>
    </div>
  </div>
}
