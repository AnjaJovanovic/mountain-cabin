<div class="admin-wrapper">
  <header class="admin-header">
    <img src="uploads/logo.png" alt="Mountain Cabin logo" class="logo">
    <h2>Admin panel</h2>
    <button class="logout-btn" (click)="logout()">Odjava</button>
  </header>

  <main class="admin-content">
    <h3>Upravljanje korisnicima</h3>
    <p class="message">{{ message }}</p>

    <div class="table-container">
      <table class="user-table">
        <thead>
          <tr>
            <th>Korisničko ime</th>
            <th>Aktivan</th>
            <th>Blokiran</th>
            <th>Akcije</th>
          </tr>
        </thead>

        <tbody>
          @for (u of allUsers; track u.username) {
            <tr>
              <td>{{ u.username }}</td>
              <td>
                <span class="status" [class.active]="u.isActive" [class.inactive]="!u.isActive">
                  {{ u.isActive ? 'Da' : 'Ne' }}
                </span>
              </td>
              <td>
                <span class="status" [class.blocked]="u.isBlocked" [class.unblocked]="!u.isBlocked">
                  {{ u.isBlocked ? 'Da' : 'Ne' }}
                </span>
              </td>
              <td class="actions">
                <button (click)="activateUser(u.username)" [disabled]="u.isActive">Aktiviraj</button>
                <button (click)="deactivateUser(u.username)" [disabled]="!u.isActive">Deaktiviraj</button>
                <button (click)="blockUser(u.username)" [disabled]="u.isBlocked">Blokiraj</button>
                <button (click)="unblockUser(u.username)" [disabled]="!u.isBlocked">Odblokiraj</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <h3 style="margin-top: 40px;">Upravljanje vikendicama</h3>
    <div class="table-container">
      <table class="user-table vikendice-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Naziv</th>
            <th>Mesto</th>
            <th>Vlasnik</th>
            <th>Prosečna ocena</th>
            <th>Status</th>
            <th>Akcije</th>
          </tr>
        </thead>

        <tbody>
          @for (v of allVikendice; track v.idVikendice) {
            <tr [class.low-rating]="hasLowRatings(v)" [class.blocked-row]="isBlocked(v)">
              <td>{{ v.idVikendice }}</td>
              <td>{{ v.naziv }}</td>
              <td>{{ v.mesto }}</td>
              <td>{{ v.ownerUsername }}</td>
              <td>{{ v.prosecnaOcena ? v.prosecnaOcena.toFixed(1) : 'Nema ocene' }}</td>
              <td>
                @if (isBlocked(v)) {
                  <span class="status blocked">Blokirana do {{ formatDate(v.blockedUntil) }}</span>
                } @else if (hasLowRatings(v)) {
                  <span class="status low-rating-badge">Niska ocena</span>
                } @else {
                  <span class="status active">Aktivna</span>
                }
              </td>
              <td class="actions">
                @if (hasLowRatings(v) && !isBlocked(v)) {
                  <button (click)="blockVikendica(v.idVikendice)" class="btn-block-vikendica">Blokiraj 48h</button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </main>
</div>
